
(function(c){c.fn.jOrgChart=function(f){var h=c.extend({},c.fn.jOrgChart.defaults,f);var d=c(h.chartElement);$this=c(this);var j=c("<div class='"+h.chartClass+"'/>");if($this.is("ul")){a($this.find("li:first"),j,0,h)}else{if($this.is("li")){a($this,j,0,h)}}d.append(j);if(h.dragAndDrop){c("div.node").draggable({cursor:"move",distance:40,helper:"clone",opacity:0.8,revert:"invalid",revertDuration:100,snap:"div.node.expanded",snapMode:"inner",stack:"div.node"});c("div.node").droppable({accept:".node",activeClass:"drag-active",hoverClass:"drop-hover"});c("div.node").bind("dragstart",function i(l,m){var k=c(this);k.parentsUntil(".node-container").find("*").filter(".node").droppable("disable")});c("div.node").bind("dragstop",function g(k,l){c(h.chartElement).children().remove();$this.jOrgChart(h)});c("div.node").bind("drop",function e(o,p){var l=c(this).data("tree-node");var m=$this.find("li").filter(function(){return c(this).data("tree-node")===l});var r=m.children("ul");var n=p.draggable.data("tree-node");var q=$this.find("li").filter(function(){return c(this).data("tree-node")===n});var k=q.parent("ul");if(r.length>0){r.append(q)}else{m.append("<ul></ul>");m.children("ul").append(q)}if(k.children().length===0){k.remove()}})}};c.fn.jOrgChart.defaults={chartElement:"body",depth:-1,chartClass:"jOrgChart",dragAndDrop:false};var b=0;function a(g,p,f,e){var s=c("<table cellpadding='0' cellspacing='0' border='0'/>");var l=c("<tbody/>");var k=c("<tr/>").addClass("node-cells");var j=c("<td/>").addClass("node-cell").attr("colspan",2);var o=g.children("ul:first").children("li");var n;if(o.length>1){j.attr("colspan",o.length*2)}var r=g.clone().children("ul,li").remove().end().html();b++;g.data("tree-node",b);n=c("<div>").addClass("node").data("tree-node",b).append(r);if(o.length>0){n.click(function(){var u=c(this);var t=u.closest("tr");if(t.hasClass("contracted")){u.css("cursor","zoom-out");t.removeClass("contracted").addClass("expanded");t.nextAll("tr").css("visibility","");t.nextAll("tr").css("display","");g.removeClass("collapsed")}else{u.css("cursor","zoom-in");t.removeClass("expanded").addClass("contracted");t.nextAll("tr").css("visibility","hidden");t.nextAll("tr").css("display","none");g.addClass("collapsed")}})}j.append(n);k.append(j);l.append(k);if(o.length>0){n.css("cursor","zoom-out");if(e.depth==-1||(f+1<e.depth)){var q=c("<tr/>");var m=c("<td/>").attr("colspan",o.length*2);q.append(m);$downLine=c("<div></div>").addClass("line down");m.append($downLine);l.append(q);var i=c("<tr/>");o.each(function(){var u=c("<td>&nbsp;</td>").addClass("line left top");var t=c("<td>&nbsp;</td>").addClass("line right top");i.append(u).append(t)});i.find("td:first").removeClass("top").end().find("td:last").removeClass("top");l.append(i);var d=c("<tr/>");o.each(function(){var t=c("<td class='node-container'/>");t.attr("colspan",2);a(c(this),t,f+1,e);d.append(t)})}l.append(d)}if(g.attr("class")!=undefined){var h=g.attr("class").split(/\s+/);c.each(h,function(t,u){if(u=="collapsed"){console.log(g);k.nextAll("tr").css("visibility","hidden");k.removeClass("expanded");k.addClass("contracted");n.css("cursor","zoom-in")}else{n.addClass(u)}})}s.append(l);p.append(s);n.children("a").click(function(t){console.log(t);t.stopPropagation()})}})(jQuery);