
var locked=false;jQuery(document).ready(function(){initTree();initFilters();$("html, body").animate({scrollTop:$(".tree-container").offset().top},"slow")});var showPerson=function(b){b=appendFilters(b);var d="&ajax=1";var c=(b.indexOf(d)===-1)?b+d:b;var a=b.replace(new RegExp(d+"$"),"");$("#tree-loader").show();$("#genealogy-tree").html("");lockLinks();$.ajax(c).done(function(e){$("#tree-holder").html(e);initTree();window.history.pushState({url:a},document.title,a);$("#tree-loader").hide();releaseLinks()}).fail(function(e){alert("Error: "+e.responseText)})};var updateInfo=function(a){var c="&ajax=1";var b=(a.indexOf(c)===-1)?a+c:a;$("#info-loader").show();$("#info-body").html("");lockLinks();$.ajax(b).done(function(d){$("#panel-info").html(d);registerLinks();$("#info-loader").hide();$("#collapse-info-btn").trigger("click");releaseLinks()}).fail(function(d){alert("Error: "+d.responseText)})};var initTree=function(){$(".genealogy-kinship").each(function(){kinship=$(this).attr("data-kinship");$(this).jOrgChart({chartElement:"#"+kinship})});$("#genealogy-relations").jOrgChart({chartElement:"#genealogy-tree"});registerLinks();$(".genealogy-tree").dragScroll({});window.onpopstate=function(a){console.log("e: "+a);if(a.state.url){console.log("onpopstate: "+a.state.url);showPerson(a.state.url)}else{a.preventDefault()}}};var initFilters=function(){url=$(location).attr("href");var a=URI(url);var b=a.search(true);if(!b.m){b.m=1}if(!b.ms){b.ms=1}$("input.options-check").each(function(){kinship=$(this).attr("id");status=b[kinship];$(this).prop("checked",status==1?true:false)})};var appendFilters=function(a){var b=URI(a);localStorage.setItem("myvar","Smith");var c={};$("input[type=checkbox].options-check").each(function(){kinship=$(this).attr("id");value=this.checked?1:0;c[kinship]=value});b.setSearch(c);return b.toString()};var lockLinks=function(){$("a.info-item, a.options-item, #toggle-fullscreen, input.options-check").attr("disabled",true);locked=true};var releaseLinks=function(){locked=false;$("a.info-item, a.options-item, #toggle-fullscreen, input.options-check").attr("disabled",false)};var registerLinks=function(){$("a.info-item").click(function(a){a.preventDefault();if(locked){return}url=$(this).attr("data-url");updateInfo(url)});$("a.options-item").click(function(a){a.preventDefault();if(locked){return}url=$(this).attr("href");showPerson(url)});$("#toggle-fullscreen").on("click",function(){event.preventDefault();if(locked){return}$(".tree-container").toggleFullScreen()});$("input[type=checkbox]#f").change(function(){event.preventDefault();if(!this.checked){$("input#fs").prop("checked",false)}});$("input[type=checkbox]#fs").change(function(){event.preventDefault();if(this.checked){$("input#f").prop("checked",true)}});$("input[type=checkbox]#m").change(function(){event.preventDefault();if(!this.checked){$("input#ms").prop("checked",false)}});$("input[type=checkbox]#ms").change(function(){event.preventDefault();if(this.checked){$("input#m").prop("checked",true)}});$("input.options-check").change(function(){event.preventDefault();if(locked){return}url=$(location).attr("href");showPerson(url)})};