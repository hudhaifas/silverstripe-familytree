
var locked=false;jQuery(document).ready(function(){initTree();fillForms();$("html, body").animate({scrollTop:$(".tree-container").offset().top},"slow")});var showPerson=function(b){console.log("url: "+b);var d="&ajax=1";var c=(b.indexOf(d)===-1)?b+d:b;var a=b.replace(new RegExp(d+"$"),"");$("#tree-loader").show();$("#genealogy-tree").html("");lockLinks();console.log("ajaxUrl: "+c);$.ajax(c).done(function(e){$("#tree-holder").html(e);initTree();window.history.pushState({url:a},document.title,a);$("#tree-loader").hide();releaseLinks()}).fail(function(e){alert("Error: "+e.responseText)})};var updateInfo=function(a){var c="&ajax=1";var b=(a.indexOf(c)===-1)?a+c:a;$("#info-loader").show();$("#info-body").html("");lockLinks();$.ajax(b).done(function(d){$("#panel-info").html(d);registerLinks();$("#info-loader").hide();$("#collapse-info-btn").trigger("click");releaseLinks()}).fail(function(d){alert("Error: "+d.responseText)})};var initTree=function(){$("#genealogy-relations").jOrgChart({chartElement:"#genealogy-tree"});registerLinks();$("#genealogy-tree").dragScroll({});window.onpopstate=function(a){console.log("e: "+a);if(a.state.url){console.log("onpopstate: "+a.state.url);showPerson(a.state.url)}else{a.preventDefault()}}};var fillForms=function(){url=$(location).attr("href");var a=URI(url);console.log(a.toString());var b=a.search(true);console.log(b);$("input.options-check").each(function(){id=$(this).attr("id");status=b[id];$(this).prop("checked",status==1?true:false)})};var registerLinks=function(){$("a.info-item").click(function(a){a.preventDefault();if(locked){return}url=$(this).attr("data-url");updateInfo(url)});$("a.options-item").click(function(a){a.preventDefault();if(locked){return}url=$(this).attr("href");showPerson(url)});$("#toggle-fullscreen").on("click",function(){event.preventDefault();if(locked){return}$(".tree-container").toggleFullScreen()});$("input.options-check").change(function(){event.preventDefault();if(locked){return}url=$(location).attr("href");var a=URI(url);var b={};$("input.options-check").each(function(){id=$(this).attr("id");value=this.checked?1:0;b[id]=value});a.setSearch(b);showPerson(a.toString())});$("input#f").change(function(){event.preventDefault();if(locked){return}if(!this.checked){$("input#fch").prop("checked",false)}});$("input#fch").change(function(){event.preventDefault();if(locked){return}if(this.checked){$("input#f").prop("checked",true)}})};var lockLinks=function(){$("a.info-item, a.options-item, #toggle-fullscreen, input.options-check").attr("disabled",true);locked=true};var releaseLinks=function(){locked=false;$("a.info-item, a.options-item, #toggle-fullscreen, input.options-check").attr("disabled",false)};