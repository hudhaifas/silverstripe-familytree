
/*! URI.js v1.18.4 http://medialize.github.io/URI.js/ */
(function(b,a){"object"===typeof module&&module.exports?module.exports=a(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"===typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],a):b.URI=a(b.punycode,b.IPv6,b.SecondLevelDomains,b)})(this,function(X,V,L,Q){function Z(e,d){var g=1<=arguments.length,f=2<=arguments.length;if(!(this instanceof Z)){return g?f?new Z(e,d):new Z(e):new Z}if(void 0===e){if(g){throw new TypeError("undefined is not a valid argument for URI")}e="undefined"!==typeof location?location.href+"":""}this.href(e);return void 0!==d?this.absoluteTo(d):this}function T(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function S(d){return void 0===d?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function U(d){return"Array"===S(d)}function R(g,f){var l={},h,e;if("RegExp"===S(f)){l=null}else{if(U(f)){for(h=0,e=f.length;h<e;h++){l[f[h]]=!0}}else{l[f]=!0}}h=0;for(e=g.length;h<e;h++){if(l&&void 0!==l[g[h]]||!l&&f.test(g[h])){g.splice(h,1),e--,h--}}return g}function i(g,f){var l,h;if(U(f)){l=0;for(h=f.length;l<h;l++){if(!i(g,f[l])){return !1}}return !0}var e=S(f);l=0;for(h=g.length;l<h;l++){if("RegExp"===e){if("string"===typeof g[l]&&g[l].match(f)){return !0}}else{if(g[l]===f){return !0}}}return !1}function P(f,e){if(!U(f)||!U(e)||f.length!==e.length){return !1}f.sort();e.sort();for(var h=0,g=f.length;h<g;h++){if(f[h]!==e[h]){return !1}}return !0}function W(d){return d.replace(/^\/+|\/+$/g,"")}function J(d){return escape(d)}function O(d){return encodeURIComponent(d).replace(/[!'()*]/g,J).replace(/\*/g,"%2A")}function b(d){return function(e,f){if(void 0===e){return this._parts[d]||""}this._parts[d]=e||null;this.build(!f);return this}}function M(e,d){return function(g,f){if(void 0===g){return this._parts[e]||""}null!==g&&(g+="",g.charAt(0)===d&&(g=g.substring(1)));this._parts[e]=g;this.build(!f);return this}}var K=Q&&Q.URI;Z.version="1.18.4";var Y=Z.prototype,o=Object.prototype.hasOwnProperty;Z._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:Z.duplicateQueryParameters,escapeQuerySpace:Z.escapeQuerySpace}};Z.duplicateQueryParameters=!1;Z.escapeQuerySpace=!0;Z.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;Z.idn_expression=/[^a-z0-9\.-]/i;Z.punycode_expression=/(xn--)/i;Z.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;Z.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;Z.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;Z.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g};Z.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};Z.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;Z.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};Z.getDomAttribute=function(e){if(e&&e.nodeName){var d=e.nodeName.toLowerCase();if("input"!==d||"image"===e.type){return Z.domAttributes[d]}}};Z.encode=O;Z.decode=decodeURIComponent;Z.iso8859=function(){Z.encode=escape;Z.decode=unescape};Z.unicode=function(){Z.encode=O;Z.decode=decodeURIComponent};Z.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}};Z.encodeQuery=function(e,d){var f=Z.encode(e+"");void 0===d&&(d=Z.escapeQuerySpace);return d?f.replace(/%20/g,"+"):f};Z.decodeQuery=function(e,d){e+="";void 0===d&&(d=Z.escapeQuerySpace);try{return Z.decode(d?e.replace(/\+/g,"%20"):e)}catch(f){return e}};var k={encode:"encode",decode:"decode"},a,N=function(e,d){return function(g){try{return Z[d](g+"").replace(Z.characters[e][d].expression,function(h){return Z.characters[e][d].map[h]})}catch(f){return g}}};for(a in k){Z[a+"PathSegment"]=N("pathname",k[a]),Z[a+"UrnPathSegment"]=N("urnpath",k[a])}k=function(e,d,f){return function(l){var h;h=f?function(g){return Z[d](Z[f](g))}:Z[d];l=(l+"").split(e);for(var p=0,n=l.length;p<n;p++){l[p]=h(l[p])}return l.join(e)}};Z.decodePath=k("/","decodePathSegment");Z.decodeUrnPath=k(":","decodeUrnPathSegment");Z.recodePath=k("/","encodePathSegment","decode");Z.recodeUrnPath=k(":","encodeUrnPathSegment","decode");Z.encodeReserved=N("reserved","encode");Z.parse=function(e,d){var f;d||(d={});f=e.indexOf("#");-1<f&&(d.fragment=e.substring(f+1)||null,e=e.substring(0,f));f=e.indexOf("?");-1<f&&(d.query=e.substring(f+1)||null,e=e.substring(0,f));"//"===e.substring(0,2)?(d.protocol=null,e=e.substring(2),e=Z.parseAuthority(e,d)):(f=e.indexOf(":"),-1<f&&(d.protocol=e.substring(0,f)||null,d.protocol&&!d.protocol.match(Z.protocol_expression)?d.protocol=void 0:"//"===e.substring(f+1,f+3)?(e=e.substring(f+3),e=Z.parseAuthority(e,d)):(e=e.substring(f+1),d.urn=!0)));d.path=e;return d};Z.parseHost=function(g,f){g=g.replace(/\\/g,"/");var l=g.indexOf("/"),h;-1===l&&(l=g.length);if("["===g.charAt(0)){h=g.indexOf("]"),f.hostname=g.substring(1,h)||null,f.port=g.substring(h+2,l)||null,"/"===f.port&&(f.port=null)}else{var e=g.indexOf(":");h=g.indexOf("/");e=g.indexOf(":",e+1);-1!==e&&(-1===h||e<h)?(f.hostname=g.substring(0,l)||null,f.port=null):(h=g.substring(0,l).split(":"),f.hostname=h[0]||null,f.port=h[1]||null)}f.hostname&&"/"!==g.substring(l).charAt(0)&&(l++,g="/"+g);return g.substring(l)||"/"};Z.parseAuthority=function(e,d){e=Z.parseUserinfo(e,d);return Z.parseHost(e,d)};Z.parseUserinfo=function(e,d){var g=e.indexOf("/"),f=e.lastIndexOf("@",-1<g?g:e.length-1);-1<f&&(-1===g||f<g)?(g=e.substring(0,f).split(":"),d.username=g[0]?Z.decode(g[0]):null,g.shift(),d.password=g[0]?Z.decode(g.join(":")):null,e=e.substring(f+1)):(d.username=null,d.password=null);return e};Z.parseQuery=function(l,h){if(!l){return{}}l=l.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!l){return{}}for(var t={},n=l.split("&"),d=n.length,r,p,q=0;q<d;q++){if(r=n[q].split("="),p=Z.decodeQuery(r.shift(),h),r=r.length?Z.decodeQuery(r.join("="),h):null,o.call(t,p)){if("string"===typeof t[p]||null===t[p]){t[p]=[t[p]]}t[p].push(r)}else{t[p]=r}}return t};Z.build=function(e){var d="";e.protocol&&(d+=e.protocol+":");e.urn||!d&&!e.hostname||(d+="//");d+=Z.buildAuthority(e)||"";"string"===typeof e.path&&("/"!==e.path.charAt(0)&&"string"===typeof e.hostname&&(d+="/"),d+=e.path);"string"===typeof e.query&&e.query&&(d+="?"+e.query);"string"===typeof e.fragment&&e.fragment&&(d+="#"+e.fragment);return d};Z.buildHost=function(e){var d="";if(e.hostname){d=Z.ip6_expression.test(e.hostname)?d+("["+e.hostname+"]"):d+e.hostname}else{return""}e.port&&(d+=":"+e.port);return d};Z.buildAuthority=function(d){return Z.buildUserinfo(d)+Z.buildHost(d)};Z.buildUserinfo=function(e){var d="";e.username&&(d+=Z.encode(e.username));e.password&&(d+=":"+Z.encode(e.password));d&&(d+="@");return d};Z.buildQuery=function(l,h,t){var n="",d,r,p,q;for(r in l){if(o.call(l,r)&&r){if(U(l[r])){for(d={},p=0,q=l[r].length;p<q;p++){void 0!==l[r][p]&&void 0===d[l[r][p]+""]&&(n+="&"+Z.buildQueryParameter(r,l[r][p],t),!0!==h&&(d[l[r][p]+""]=!0))}}else{void 0!==l[r]&&(n+="&"+Z.buildQueryParameter(r,l[r],t))}}}return n.substring(1)};Z.buildQueryParameter=function(e,d,f){return Z.encodeQuery(e,f)+(null!==d?"="+Z.encodeQuery(d,f):"")};Z.addQuery=function(e,d,g){if("object"===typeof d){for(var f in d){o.call(d,f)&&Z.addQuery(e,f,d[f])}}else{if("string"===typeof d){void 0===e[d]?e[d]=g:("string"===typeof e[d]&&(e[d]=[e[d]]),U(g)||(g=[g]),e[d]=(e[d]||[]).concat(g))}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}};Z.removeQuery=function(e,d,g){var f;if(U(d)){for(g=0,f=d.length;g<f;g++){e[d[g]]=void 0}}else{if("RegExp"===S(d)){for(f in e){d.test(f)&&(e[f]=void 0)}}else{if("object"===typeof d){for(f in d){o.call(d,f)&&Z.removeQuery(e,f,d[f])}}else{if("string"===typeof d){void 0!==g?"RegExp"===S(g)?!U(e[d])&&g.test(e[d])?e[d]=void 0:e[d]=R(e[d],g):e[d]!==String(g)||U(g)&&1!==g.length?U(e[d])&&(e[d]=R(e[d],g)):e[d]=void 0:e[d]=void 0}else{throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")}}}}};Z.hasQuery=function(g,f,n,h){switch(S(f)){case"String":break;case"RegExp":for(var d in g){if(o.call(g,d)&&f.test(d)&&(void 0===n||Z.hasQuery(g,d,n))){return !0}}return !1;case"Object":for(var l in f){if(o.call(f,l)&&!Z.hasQuery(g,l,f[l])){return !1}}return !0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(S(n)){case"Undefined":return f in g;case"Boolean":return g=!(U(g[f])?!g[f].length:!g[f]),n===g;case"Function":return !!n(g[f],f,g);case"Array":return U(g[f])?(h?i:P)(g[f],n):!1;case"RegExp":return U(g[f])?h?i(g[f],n):!1:!(!g[f]||!g[f].match(n));case"Number":n=String(n);case"String":return U(g[f])?h?i(g[f],n):!1:g[f]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};Z.joinPaths=function(){for(var g=[],f=[],n=0,h=0;h<arguments.length;h++){var d=new Z(arguments[h]);g.push(d);for(var d=d.segment(),l=0;l<d.length;l++){"string"===typeof d[l]&&f.push(d[l]),d[l]&&n++}}if(!f.length||!n){return new Z("")}f=(new Z("")).segment(f);""!==g[0].path()&&"/"!==g[0].path().slice(0,1)||f.path("/"+f.path());return f.normalize()};Z.commonPath=function(f,e){var h=Math.min(f.length,e.length),g;for(g=0;g<h;g++){if(f.charAt(g)!==e.charAt(g)){g--;break}}if(1>g){return f.charAt(0)===e.charAt(0)&&"/"===f.charAt(0)?"/":""}if("/"!==f.charAt(g)||"/"!==e.charAt(g)){g=f.substring(0,g).lastIndexOf("/")}return f.substring(0,g+1)};Z.withinString=function(B,A,z){z||(z={});var t=z.start||Z.findUri.start,y=z.end||Z.findUri.end,w=z.trim||Z.findUri.trim,x=z.parens||Z.findUri.parens,C=/[a-z0-9-]=["']?$/i;for(t.lastIndex=0;;){var v=t.exec(B);if(!v){break}v=v.index;if(z.ignoreHtml){var q=B.slice(Math.max(v-3,0),v);if(q&&C.test(q)){continue}}for(var d=v+B.slice(v).search(y),q=B.slice(v,d),d=-1;;){var n=x.exec(q);if(!n){break}d=Math.max(d,n.index+n[0].length)}q=-1<d?q.slice(0,d)+q.slice(d+1).replace(w,""):q.replace(w,"");z.ignore&&z.ignore.test(q)||(d=v+q.length,q=A(q,v,d,B),void 0===q?t.lastIndex=d:(q=String(q),B=B.slice(0,v)+q+B.slice(d),t.lastIndex=v+q.length))}t.lastIndex=0;return B};Z.ensureValidHostname=function(d){if(d.match(Z.invalid_hostname_characters)){if(!X){throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available')}if(X.toASCII(d).match(Z.invalid_hostname_characters)){throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]')}}};Z.noConflict=function(d){if(d){return d={URI:this.noConflict()},Q.URITemplate&&"function"===typeof Q.URITemplate.noConflict&&(d.URITemplate=Q.URITemplate.noConflict()),Q.IPv6&&"function"===typeof Q.IPv6.noConflict&&(d.IPv6=Q.IPv6.noConflict()),Q.SecondLevelDomains&&"function"===typeof Q.SecondLevelDomains.noConflict&&(d.SecondLevelDomains=Q.SecondLevelDomains.noConflict()),d}Q.URI===this&&(Q.URI=K);return this};Y.build=function(d){if(!0===d){this._deferred_build=!0}else{if(void 0===d||this._deferred_build){this._string=Z.build(this._parts),this._deferred_build=!1}}return this};Y.clone=function(){return new Z(this)};Y.valueOf=Y.toString=function(){return this.build(!1)._string};Y.protocol=b("protocol");Y.username=b("username");Y.password=b("password");Y.hostname=b("hostname");Y.port=b("port");Y.query=M("query","?");Y.fragment=M("fragment","#");Y.search=function(e,d){var f=this.query(e,d);return"string"===typeof f&&f.length?"?"+f:f};Y.hash=function(e,d){var f=this.fragment(e,d);return"string"===typeof f&&f.length?"#"+f:f};Y.pathname=function(e,d){if(void 0===e||!0===e){var f=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?Z.decodeUrnPath:Z.decodePath)(f):f}this._parts.path=this._parts.urn?e?Z.recodeUrnPath(e):"":e?Z.recodePath(e):"/";this.build(!d);return this};Y.path=Y.pathname;Y.href=function(f,d){var l;if(void 0===f){return this.toString()}this._string="";this._parts=Z._parts();var g=f instanceof Z,h="object"===typeof f&&(f.hostname||f.path||f.pathname);f.nodeName&&(h=Z.getDomAttribute(f),f=f[h]||"",h=!1);!g&&h&&void 0!==f.pathname&&(f=f.toString());if("string"===typeof f||f instanceof String){this._parts=Z.parse(String(f),this._parts)}else{if(g||h){for(l in g=g?f._parts:f,g){o.call(this._parts,l)&&(this._parts[l]=g[l])}}else{throw new TypeError("invalid input")}}this.build(!d);return this};Y.is=function(w){var v=!1,u=!1,n=!1,t=!1,q=!1,r=!1,d=!1,p=!this._parts.urn;this._parts.hostname&&(p=!1,u=Z.ip4_expression.test(this._parts.hostname),n=Z.ip6_expression.test(this._parts.hostname),v=u||n,q=(t=!v)&&L&&L.has(this._parts.hostname),r=t&&Z.idn_expression.test(this._parts.hostname),d=t&&Z.punycode_expression.test(this._parts.hostname));switch(w.toLowerCase()){case"relative":return p;case"absolute":return !p;case"domain":case"name":return t;case"sld":return q;case"ip":return v;case"ip4":case"ipv4":case"inet4":return u;case"ip6":case"ipv6":case"inet6":return n;case"idn":return r;case"url":return !this._parts.urn;case"urn":return !!this._parts.urn;case"punycode":return d}return null};var s=Y.protocol,m=Y.port,j=Y.hostname;Y.protocol=function(e,d){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,""),!e.match(Z.protocol_expression))){throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]")}return s.call(this,e,d)};Y.scheme=Y.protocol;Y.port=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),e.match(/[^0-9]/)))){throw new TypeError('Port "'+e+'" contains characters other than [0-9]')}return m.call(this,e,d)};Y.hostname=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0!==e){var f={};if("/"!==Z.parseHost(e,f)){throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}e=f.hostname}return j.call(this,e,d)};Y.origin=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){var f=this.protocol();return this.authority()?(f?f+"://":"")+this.authority():""}f=Z(e);this.protocol(f.protocol()).authority(f.authority()).build(!d);return this};Y.host=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){return this._parts.hostname?Z.buildHost(this._parts):""}if("/"!==Z.parseHost(e,this._parts)){throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}this.build(!d);return this};Y.authority=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){return this._parts.hostname?Z.buildAuthority(this._parts):""}if("/"!==Z.parseAuthority(e,this._parts)){throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}this.build(!d);return this};Y.userinfo=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){var f=Z.buildUserinfo(this._parts);return f?f.substring(0,f.length-1):f}"@"!==e[e.length-1]&&(e+="@");Z.parseUserinfo(e,this._parts);this.build(!d);return this};Y.resource=function(e,d){var f;if(void 0===e){return this.path()+this.search()+this.hash()}f=Z.parse(e);this._parts.path=f.path;this._parts.query=f.query;this._parts.fragment=f.fragment;this.build(!d);return this};Y.subdomain=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""}var f=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,f)||""}f=this._parts.hostname.length-this.domain().length;f=this._parts.hostname.substring(0,f);f=new RegExp("^"+T(f));e&&"."!==e.charAt(e.length-1)&&(e+=".");e&&Z.ensureValidHostname(e);this._parts.hostname=this._parts.hostname.replace(f,e);this.build(!d);return this};Y.domain=function(e,d){if(this._parts.urn){return void 0===e?"":this}"boolean"===typeof e&&(d=e,e=void 0);if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""}var f=this._parts.hostname.match(/\./g);if(f&&2>f.length){return this._parts.hostname}f=this._parts.hostname.length-this.tld(d).length-1;f=this._parts.hostname.lastIndexOf(".",f-1)+1;return this._parts.hostname.substring(f)||""}if(!e){throw new TypeError("cannot set domain empty")}Z.ensureValidHostname(e);!this._parts.hostname||this.is("IP")?this._parts.hostname=e:(f=new RegExp(T(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(f,e));this.build(!d);return this};Y.tld=function(e,d){if(this._parts.urn){return void 0===e?"":this}"boolean"===typeof e&&(d=e,e=void 0);if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""}var f=this._parts.hostname.lastIndexOf("."),f=this._parts.hostname.substring(f+1);return !0!==d&&L&&L.list[f.toLowerCase()]?L.get(this._parts.hostname)||f:f}if(e){if(e.match(/[^a-zA-Z0-9-]/)){if(L&&L.is(e)){f=new RegExp(T(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(f,e)}else{throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]')}}else{if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")}f=new RegExp(T(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(f,e)}}else{throw new TypeError("cannot set TLD empty")}this.build(!d);return this};Y.directory=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname){return""}if("/"===this._parts.path){return"/"}var f=this._parts.path.length-this.filename().length-1,f=this._parts.path.substring(0,f)||(this._parts.hostname?"/":"");return e?Z.decodePath(f):f}f=this._parts.path.length-this.filename().length;f=this._parts.path.substring(0,f);f=new RegExp("^"+T(f));this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e));e&&"/"!==e.charAt(e.length-1)&&(e+="/");e=Z.recodePath(e);this._parts.path=this._parts.path.replace(f,e);this.build(!d);return this};Y.filename=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path){return""}var g=this._parts.path.lastIndexOf("/"),g=this._parts.path.substring(g+1);return e?Z.decodePathSegment(g):g}g=!1;"/"===e.charAt(0)&&(e=e.substring(1));e.match(/\.?\//)&&(g=!0);var f=new RegExp(T(this.filename())+"$");e=Z.recodePath(e);this._parts.path=this._parts.path.replace(f,e);g?this.normalizePath(d):this.build(!d);return this};Y.suffix=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path){return""}var g=this.filename(),f=g.lastIndexOf(".");if(-1===f){return""}g=g.substring(f+1);g=/^[a-z0-9%]+$/i.test(g)?g:"";return e?Z.decodePathSegment(g):g}"."===e.charAt(0)&&(e=e.substring(1));if(g=this.suffix()){f=e?new RegExp(T(g)+"$"):new RegExp(T("."+g)+"$")}else{if(!e){return this}this._parts.path+="."+Z.recodePath(e)}f&&(e=Z.recodePath(e),this._parts.path=this._parts.path.replace(f,e));this.build(!d);return this};Y.segment=function(l,g,t){var r=this._parts.urn?":":"/",q=this.path(),p="/"===q.substring(0,1),q=q.split(r);void 0!==l&&"number"!==typeof l&&(t=g,g=l,l=void 0);if(void 0!==l&&"number"!==typeof l){throw Error('Bad segment "'+l+'", must be 0-based integer')}p&&q.shift();0>l&&(l=Math.max(q.length+l,0));if(void 0===g){return void 0===l?q:q[l]}if(null===l||void 0===q[l]){if(U(g)){q=[];l=0;for(var n=g.length;l<n;l++){if(g[l].length||q.length&&q[q.length-1].length){q.length&&!q[q.length-1].length&&q.pop(),q.push(W(g[l]))}}}else{if(g||"string"===typeof g){g=W(g),""===q[q.length-1]?q[q.length-1]=g:q.push(g)}}}else{g?q[l]=W(g):q.splice(l,1)}p&&q.unshift("");return this.path(q.join(r),t)};Y.segmentCoded=function(f,d,n){var l,h;"number"!==typeof f&&(n=d,d=f,f=void 0);if(void 0===d){f=this.segment(f,d,n);if(U(f)){for(l=0,h=f.length;l<h;l++){f[l]=Z.decode(f[l])}}else{f=void 0!==f?Z.decode(f):void 0}return f}if(U(d)){for(l=0,h=d.length;l<h;l++){d[l]=Z.encode(d[l])}}else{d="string"===typeof d||d instanceof String?Z.encode(d):d}return this.segment(f,d,n)};var c=Y.query;Y.query=function(f,d){if(!0===f){return Z.parseQuery(this._parts.query,this._parts.escapeQuerySpace)}if("function"===typeof f){var h=Z.parseQuery(this._parts.query,this._parts.escapeQuerySpace),g=f.call(this,h);this._parts.query=Z.buildQuery(g||h,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!d);return this}return void 0!==f&&"string"!==typeof f?(this._parts.query=Z.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!d),this):c.call(this,f,d)};Y.setQuery=function(f,d,n){var l=Z.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"===typeof f||f instanceof String){l[f]=void 0!==d?d:null}else{if("object"===typeof f){for(var h in f){o.call(f,h)&&(l[h]=f[h])}}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}this._parts.query=Z.buildQuery(l,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof f&&(n=d);this.build(!n);return this};Y.addQuery=function(f,d,h){var g=Z.parseQuery(this._parts.query,this._parts.escapeQuerySpace);Z.addQuery(g,f,void 0===d?null:d);this._parts.query=Z.buildQuery(g,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof f&&(h=d);this.build(!h);return this};Y.removeQuery=function(f,d,h){var g=Z.parseQuery(this._parts.query,this._parts.escapeQuerySpace);Z.removeQuery(g,f,d);this._parts.query=Z.buildQuery(g,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof f&&(h=d);this.build(!h);return this};Y.hasQuery=function(f,d,h){var g=Z.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return Z.hasQuery(g,f,d,h)};Y.setSearch=Y.setQuery;Y.addSearch=Y.addQuery;Y.removeSearch=Y.removeQuery;Y.hasSearch=Y.hasQuery;Y.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};Y.normalizeProtocol=function(d){"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d));return this};Y.normalizeHostname=function(d){this._parts.hostname&&(this.is("IDN")&&X?this._parts.hostname=X.toASCII(this._parts.hostname):this.is("IPv6")&&V&&(this._parts.hostname=V.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d));return this};Y.normalizePort=function(d){"string"===typeof this._parts.protocol&&this._parts.port===Z.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d));return this};Y.normalizePath=function(h){var d=this._parts.path;if(!d){return this}if(this._parts.urn){return this._parts.path=Z.recodeUrnPath(this._parts.path),this.build(!h),this}if("/"===this._parts.path){return this}var d=Z.recodePath(d),q,p="",l,n;"/"!==d.charAt(0)&&(q=!0,d="/"+d);if("/.."===d.slice(-3)||"/."===d.slice(-2)){d+="/"}d=d.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");q&&(p=d.substring(1).match(/^(\.\.\/)+/)||"")&&(p=p[0]);for(;;){l=d.search(/\/\.\.(\/|$)/);if(-1===l){break}else{if(0===l){d=d.substring(3);continue}}n=d.substring(0,l).lastIndexOf("/");-1===n&&(n=l);d=d.substring(0,n)+d.substring(l+3)}q&&this.is("relative")&&(d=p+d.substring(1));this._parts.path=d;this.build(!h);return this};Y.normalizePathname=Y.normalizePath;Y.normalizeQuery=function(d){"string"===typeof this._parts.query&&(this._parts.query.length?this.query(Z.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d));return this};Y.normalizeFragment=function(d){this._parts.fragment||(this._parts.fragment=null,this.build(!d));return this};Y.normalizeSearch=Y.normalizeQuery;Y.normalizeHash=Y.normalizeFragment;Y.iso8859=function(){var e=Z.encode,d=Z.decode;Z.encode=escape;Z.decode=decodeURIComponent;try{this.normalize()}finally{Z.encode=e,Z.decode=d}return this};Y.unicode=function(){var e=Z.encode,d=Z.decode;Z.encode=O;Z.decode=unescape;try{this.normalize()}finally{Z.encode=e,Z.decode=d}return this};Y.readable=function(){var n=this.clone();n.username("").password("").normalize();var d="";n._parts.protocol&&(d+=n._parts.protocol+"://");n._parts.hostname&&(n.is("punycode")&&X?(d+=X.toUnicode(n._parts.hostname),n._parts.port&&(d+=":"+n._parts.port)):d+=n.host());n._parts.hostname&&n._parts.path&&"/"!==n._parts.path.charAt(0)&&(d+="/");d+=n.path(!0);if(n._parts.query){for(var t="",r=0,q=n._parts.query.split("&"),f=q.length;r<f;r++){var p=(q[r]||"").split("="),t=t+("&"+Z.decodeQuery(p[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==p[1]&&(t+="="+Z.decodeQuery(p[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}d+="?"+t.substring(1)}return d+=Z.decodeQuery(n.hash(),!0)};Y.absoluteTo=function(f){var d=this.clone(),n=["protocol","username","password","hostname","port"],l,h;if(this._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")}f instanceof Z||(f=new Z(f));d._parts.protocol||(d._parts.protocol=f._parts.protocol);if(this._parts.hostname){return d}for(l=0;h=n[l];l++){d._parts[h]=f._parts[h]}d._parts.path?(".."===d._parts.path.substring(-2)&&(d._parts.path+="/"),"/"!==d.path().charAt(0)&&(n=(n=f.directory())?n:0===f.path().indexOf("/")?"/":"",d._parts.path=(n?n+"/":"")+d._parts.path,d.normalizePath())):(d._parts.path=f._parts.path,d._parts.query||(d._parts.query=f._parts.query));d.build();return d};Y.relativeTo=function(f){var d=this.clone().normalize(),n,l,h;if(d._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")}f=(new Z(f)).normalize();n=d._parts;l=f._parts;h=d.path();f=f.path();if("/"!==h.charAt(0)){throw Error("URI is already relative")}if("/"!==f.charAt(0)){throw Error("Cannot calculate a URI relative to another relative URI")}n.protocol===l.protocol&&(n.protocol=null);if(n.username===l.username&&n.password===l.password&&null===n.protocol&&null===n.username&&null===n.password&&n.hostname===l.hostname&&n.port===l.port){n.hostname=null,n.port=null}else{return d.build()}if(h===f){return n.path="",d.build()}h=Z.commonPath(h,f);if(!h){return d.build()}l=l.path.substring(h.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");n.path=l+n.path.substring(h.length)||"./";return d.build()};Y.equals=function(h){var d=this.clone(),q=new Z(h),p;h={};var l,n;d.normalize();q.normalize();if(d.toString()===q.toString()){return !0}l=d.query();p=q.query();d.query("");q.query("");if(d.toString()!==q.toString()||l.length!==p.length){return !1}d=Z.parseQuery(l,this._parts.escapeQuerySpace);p=Z.parseQuery(p,this._parts.escapeQuerySpace);for(n in d){if(o.call(d,n)){if(!U(d[n])){if(d[n]!==p[n]){return !1}}else{if(!P(d[n],p[n])){return !1}}h[n]=!0}}for(n in p){if(o.call(p,n)&&!h[n]){return !1}}return !0};Y.duplicateQueryParameters=function(d){this._parts.duplicateQueryParameters=!!d;return this};Y.escapeQuerySpace=function(d){this._parts.escapeQuerySpace=!!d;return this};return Z});(function(b,a){"object"===typeof module&&module.exports?module.exports=a(require("jquery"),require("./URI")):"function"===typeof define&&define.amd?define(["jquery","./URI"],a):a(b.jQuery,b.URI)})(this,function(k,j){function r(f){return f.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function a(h){var f=h.nodeName.toLowerCase();if("input"!==f||"image"===h.type){return j.domAttributes[f]}}function m(f){return{get:function(d){return k(d).uri()[f]()},set:function(l,d){k(l).uri()[f](d);return d}}}function g(q,l){var p,f,s;if(!a(q)||!l){return !1}p=l.match(b);if(!p||!p[5]&&":"!==p[2]&&!i[p[2]]){return !1}s=k(q).uri();if(p[5]){return s.is(p[5])}if(":"===p[2]){return f=p[1].toLowerCase()+":",i[f]?i[f](s,p[4]):!1}f=p[1].toLowerCase();return c[f]?i[p[2]](s[f](),p[4],f):!1}var c={},i={"=":function(l,h){return l===h},"^=":function(l,h){return !!(l+"").match(new RegExp("^"+r(h),"i"))},"$=":function(l,h){return !!(l+"").match(new RegExp(r(h)+"$","i"))},"*=":function(p,n,l){"directory"===l&&(p+="/");return !!(p+"").match(new RegExp(r(n),"i"))},"equals:":function(l,h){return l.equals(h)},"is:":function(l,h){return l.is(h)}};k.each("origin authority directory domain filename fragment hash host hostname href password path pathname port protocol query resource scheme search subdomain suffix tld username".split(" "),function(f,d){c[d]=!0;k.attrHooks["uri:"+d]=m(d)});var e=function(l,f){return k(l).uri().href(f).toString()};k.each(["src","href","action","uri","cite"],function(l,f){k.attrHooks[f]={set:e}});k.attrHooks.uri.get=function(f){return k(f).uri()};k.fn.uri=function(s){var p=this.first(),q=p.get(0),h=a(q);if(!h){throw Error('Element "'+q.nodeName+'" does not have either property: href, src, action, cite')}if(void 0!==s){var t=p.data("uri");if(t){return t.href(s)}s instanceof j||(s=j(s||""))}else{if(s=p.data("uri")){return s}s=j(p.attr(h)||"")}s._dom_element=q;s._dom_attribute=h;s.normalize();p.data("uri",s);return s};j.prototype.build=function(f){if(this._dom_element){this._string=j.build(this._parts),this._deferred_build=!1,this._dom_element.setAttribute(this._dom_attribute,this._string),this._dom_element[this._dom_attribute]=this._string}else{if(!0===f){this._deferred_build=!0}else{if(void 0===f||this._deferred_build){this._string=j.build(this._parts),this._deferred_build=!1}}}return this};var o,b=/^([a-zA-Z]+)\s*([\^\$*]?=|:)\s*(['"]?)(.+)\3|^\s*([a-zA-Z0-9]+)\s*$/;o=k.expr.createPseudo?k.expr.createPseudo(function(f){return function(d){return g(d,f)}}):function(p,n,l){return g(p,l[3])};k.expr[":"].uri=o;return k});(function(b,a){"object"===typeof module&&module.exports?module.exports=a(require("./URI")):"function"===typeof define&&define.amd?define(["./URI"],a):a(b.URI)})(this,function(d){var b=d.prototype,a=b.fragment;d.fragmentPrefix="?";var c=d._parts;d._parts=function(){var e=c();e.fragmentPrefix=d.fragmentPrefix;return e};b.fragmentPrefix=function(e){this._parts.fragmentPrefix=e;return this};b.fragment=function(g,f){var i=this._parts.fragmentPrefix,e=this._parts.fragment||"";return !0===g?e.substring(0,i.length)!==i?{}:d.parseQuery(e.substring(i.length)):void 0!==g&&"string"!==typeof g?(this._parts.fragment=i+d.buildQuery(g),this.build(!f),this):a.call(this,g,f)};b.addFragment=function(i,f,g){var e=this._parts.fragmentPrefix,j=d.parseQuery((this._parts.fragment||"").substring(e.length));d.addQuery(j,i,f);this._parts.fragment=e+d.buildQuery(j);"string"!==typeof i&&(g=f);this.build(!g);return this};b.removeFragment=function(i,f,g){var e=this._parts.fragmentPrefix,j=d.parseQuery((this._parts.fragment||"").substring(e.length));d.removeQuery(j,i,f);this._parts.fragment=e+d.buildQuery(j);"string"!==typeof i&&(g=f);this.build(!g);return this};b.addHash=b.addFragment;b.removeHash=b.removeFragment;return d});